# 布朗运动、伊藤引理、BS 公式

## 1 开篇

简单的说，（标准）布朗运动是一种最简单的连续随机过程，它是描述证券价格随机性的基本模型。而对于期权或其他衍生品这些金融工具，它们的价格是相关证券资产价格的函数。因此可以说证券价格是一个随机过程，而衍生品价格是该随机过程的函数。伊藤引理提供了对随机过程的函数做微分的框架；这对于衍生品的定价意义非凡（在此之前，人们是不知道如何对随机过程的函数做微分的）。通过伊藤引理，可以写出金融衍生品价格的随机微分方程，通过对其求解便可以得到衍生品价格的模型。BS 公式就是一个最简单的例子。

## 2 布朗运动的数学定义

布朗运动是一个连续随机过程。一个随机过程是定义在时域或者空间域上的依次发生的一系列随机变量的集合。 以时域为例，如果这些随机变量在整个实数时域上都有定义，那么这个随机过程为连续随机过程；反之，如果这些随机变量仅仅在时域上一些离散的点有定义，那么该随机过程为离散随机过程。

如果一个定义在非负实数（时域）$t$ 上的连续随机过程 $\{B(t), t ≥ 0\}$ 满足如下三个性质：

1.  $B(0) = 0$ ;
2.  平稳性：对于所有的 $0 < s < t$ ，增量 $B(t) – B(s)$ 符合均值为 0，方差为 $t - s$ 的正态分布；
3.  独立增量性：对于不重叠的区间 $[s_i, t_i]$ ，随机变量 $B(t_i) – B(s_i)$ 之间是相互独立的；

则 $B(t)$ 是一个标准的布朗运动。

上述定义的白话解释是：标准布朗运动在 $t = 0$ 时的位置为 0。在任何有限时间区间 $Δt$ 内，布朗运动的变化满足均值为 0 方差为 $Δt$ 的正态分布 $\mathcal{N}(0, Δt)$ ，其方差随时间区间的长度线性增加。独立增量性的意思是布朗运动在任何一个时间区间内的变化与其他与之不重叠的时间区间内的变化无关。由该性质可知，布朗运动是一个[马尔科夫过程（Markov process）](马尔科夫过程（Markov%20process）)，即该过程在任意 $t$ 时刻之后的位置仅和 $t$ 时刻的位置有关，与 $t$ 之前的历史轨迹无关。换句话说，该过程的当前值就包含了对其未来做预测所需的全部信息。

## 3 布朗运动的性质

标准布朗运动有很多有意思的性质，它们对于使用布朗运动及其变化来描述股票价格有非常重要的含义。这些性质包括：

1.  它的轨迹会频繁的穿越时间轴 $t$ （在时间轴上下往复波动）；
2.  在任意时刻 $t$ ，它的位置 $B(t)$ 不会偏离正负一个标准差太远；
3.  令 $M(t)$ 为 0 到 $t$ 时刻内的布朗运动 $B(t)$ 所能到达的最大值，即 $M(t) = \max_{0≤s≤t}B(t)$ ，则“ $M(t)$ 不小于任意给定阈值 $a$ 的概率”等于“ $B(t)$ 不小于任意给定阈值 $a$ 的概率的两倍”，即 $\mbox{Prob}(M(t) ≥ a) = 2\mbox{Prob}(B(t) ≥ a)$ ；
4.  布朗运动虽然连续，但是它处处不可微分（这是非常关键的一个性质）。

首先来解释前两个性质。下图给出了 0 到 $t$ 时刻内 15 条标准布朗运动的样本轨迹。尽管它们呈现出各自的随机性，但基本上每条轨迹都往复的穿越 $y=0$ 这条线（即时间轴 $t$ ），仅有个别的样本轨迹在 $y=0$ 的单边震荡（对于这些轨迹，随着 $t$ 的增加，它们也一定会穿越 $t$ 轴的）。此外，黑色的抛物线是方程 $t=y^2$ 的曲线。可以看到，虽然每条样本轨迹都有足够的随机性，但是在 $t$ 时刻，它们都不会偏离这条抛物线上的点 $B(0) ± \sqrt t$ 太远。下图右侧是 $t$ 时刻均值为 0 方差为 $t$ 的正态分布的概率密度函数。这条抛物线的范围对应的就是该正态分布正负一个标准差之内的变化。

![](../../附件/Pasted%20image%2020220214101834.png)

假设我们使用布朗运动来描述股价日内的高频走势（下文会说明更加准确的描述股价的模型是带漂移项的几何布朗运动，但在此作为一个简单的例子，假设使用布朗运动来描述股价），这两个性质意味着股价很大概率会在开盘价上下波动，而非一直维持在开盘价上方或者下方；此外，随着交易时间的推移，在 t 时刻股票的价格不会偏离“ $开盘价 ± \sqrt t × 价格波动的标准差$ ”太远。这些性质对于想根据日内高频数据进行投机操作的人非常重要。量信的文章《错过开盘，不一定是“过错”》也对此有一些实证，它指出日内股价在很大概率上会再次到达开盘区间内出现的价格，而非单边震荡。

第三条性质给出了量化 $t$ 时刻内布朗运动极值的概率模型。由于 $B(t)$ 是满足均值为 0 方差为 $t$ 的正态分布，因此 $\mbox{Prob}(M(t) ≥ a) = 2\mbox{Prob}(B(t) ≥ a)$ 这个结果可以让我们非常容易的求出 $\mbox{Prob}(M(t) ≥ a)$ 的概率，即

$$\mbox{Prob}(M(t)\ge a)=2\mbox{Prob}(B(t)\ge a)=2-2\Phi\left(\frac{a}{\sqrt t}\right)$$

其中 $Φ$ 是标准正态分布的累积分布函数。上式可以通过布朗运动的马尔科夫性和反射性证明，在这里不在赘述。同样的，如果令 $m(t)$ 为 0 到 $t$ 时刻内的布朗运动 $B(t)$ 所能到达的最小值，即 $m(t) = \min_{0≤s≤t} B(t)$ ，则再次利用反射性不难推导出 $B(t)$ 的最小值低于给定阈值 $-a$ 的概率：

$$\operatorname{Prob}(m(t) \leq-a)=\operatorname{Prob}(M(t) \geq a)=2-2 \Phi\left(\frac{a}{\sqrt{t}}\right)$$

如果用布朗运动来描述股价，那么上述结果可以量化股价极值的概率分布。这对风控以及在买卖股票时计算合理的限价单价格都是很有帮助的。

最后一个性质是布朗运动作为随机过程的一个至关重要的性质，即它虽然连续，但是它处处不可微分（这一点可以通过利用中值定理以及性质三的结论，使用反证法来证明）。这从直观上非常好理解。再来看看上面那 15 条布朗运动的样本轨迹，每一条都一直在上下波动、充分地展示了其随机性。显然，布朗运动的轨迹和我们熟悉的任何连续、平滑的方程轨迹完全不同。

不可微分性意味着古典微积分（classical calculus）中的分析手段在布朗运动面前黯然失效。这在当时无疑是个令人沮丧的消息。因为人们好不容易找到了一个简单实用的随机过程，但却缺少进一步研究它的手段。然而，这一切都随着伊藤微积分（Itō calculus）的出现而迎刃而解。毫不夸张的说，伊藤微积分奠定了现代金融数学的基础。

## 4 二次变分

考虑时间区间 $[0, T]$ 和该区间内的一个划分 $\Pi = \{0 = t_0 < t_1 < t_2 < … < t_N = T\}$ ，则对于任意一个连续函数 $f(t)$ ，它的二次变分（quadratic variation）定义为：

$$\sum_{i=0}^{N-1}[f(t_{i+1})-f(t_i)]^2$$

对于一个连续且在 0 到 $T$ 内处处可微的函数 $f(t)$ ，通过利用古典微积分中的中值定理很容易得到如下不等式：

$$\begin{array}{rll} \sum_i\left(f(t_{i+1})-f(t_i)\right)^2&\le&\displaystyle\sum_i(t_{i+1}-t_i)^2f'(s_i)^2\\\\ &\le&\displaystyle\max_{s\in [0,T]}f'(s)^2\cdot\sum(t_{i+1}-t_i)^2\\\\ &\le&\displaystyle\max_{s\in[0,T]}f'(s)^2\cdot\max_i\{t_{i-1}-t_i\}\cdot T \end{array}$$

这说明随着对时间区间 $[0, T]$ 越来越细的划分，即 $|\Pi| = \max_i\{t_{i+1} - t_i\}$ 趋于 0，这个连续且处处可微的函数 $f(t)$ 的二次变分为 0。

那么，如果将 $f(t)$ 换为布朗运动 $B(t)$ 会怎样呢？不要忘了，它虽然连续，但是处处不可微。关于 $B(t)$ 的二次变分有如下定理：

随着对时间区间 $[0, T]$ 越来越细的划分，即 $\max_i\{t_{i+1} - t_i\}$ 趋于 0， $B(t)$ 的二次变分等于 $T$ ，即

$\lim_{|\Pi|\rightarrow0}\sum_i[B(t_{i+1})-B(t_i)]^2=T$

其中 $|\Pi| = \max_i\{t_{i+1} - t_i\}$。

布朗运动的这个性质可以通过独立同分布随机变量的大数定理证明。对它的白话说明是，作为一个随机过程，布朗运动的二次变分是 $T$ 而不是 0（与之相对应的是，连续可微函数的二次变分为 0）。如何理解它呢？

考虑下面这个示意图。其中蓝色曲线为布朗运动的轨迹，红点为时间划分点对应的该轨迹的位移。显然， $(B(t_{i+1}) – B(t_i))^2$ 为任意相邻两个时间点的位移差的平方。二次变分就是这些逐段位移差的累积平方和。

![](../../附件/Pasted%20image%2020220214103524.png)

对于一个普通的连续可微函数，随着对区间 T 越来越细的划分，它的二次变分趋于 0。然而对于布朗运动，其非零的二次变分说明随机性使得它的波动太频繁，以至于不管我们如何细分区间 $T$ 、得到多么微小的划分区间，这些微小区间上的位移差的平方逐段累加起来的总和都不会消失（即二次变分不为 0），而是等于这个区间的长度 $T$ ！这是布朗运动的一个非常重要的性质。

布朗运动的二次变分公式也可以写作如下所示的无穷小量（infinitesimal difference）的形式：

$$(dB)^2=dt$$

码了这么多的字来解释二次变分，当然不是为了用它说明布朗运动的波动太频繁；在本文第六节可以看到，二次变分在推导伊藤引理时有非常重要的意义。

## 5 用几何布朗运动描述股价

前文介绍了标准布朗运动，它在任意长度为 $t$ 内的分布是均值为 0 方差为 $t$ 的正态分布。现在，考虑给标准布朗运动加上一个仅和时间 $t$ 有关的漂移项 $μt$ ，以及一个尺度参数 $σ$ ，便得到一个带漂移的布朗运动（Brownian motion with drift），记作 $X(t) = μt + σB(t)$ 。它在任意长度 $t$ 内的分布满足均值为 $μt$ ，方差为 $(σ^2)t$ 的正态分布。考虑无穷小量的形式，上式写作

$$dX(t)=\mu dt+\sigma dB(t)$$

这是一个随机微分方程（stochastic differential equation）。随机微分方程是普通微分方程的延伸，不同之处在于前者之中至少包括一项随机过程。注意，上式与布朗运动不可微并不矛盾。虽然 $B(t)$ 处处不可微，但是 $dB(t)$ 仍有明确的含义，它表示布朗运动在一个无穷小的时间间隔内的变化。

即便是有了带漂移项和尺度参数的布朗运动 $X(t)$ ，它仍然不是描述股价运动的最佳选择。这是因为 $X(t)$ ，或者 $B(t)$ ，的取值随着时间 $t$ 的变化可以是负数，但是股票的价格显然不能是负数。股价虽然不能是负数，但是股票的收益率却有正有负，因此 $X(t)$ 可以被用来描述收益率。

假设 $S(t)$ 为股票的价格，则 $dS(t)$ 为股价在无穷小的时间间隔内的变化量，而 $dS(t)/S(t)$ 就是这段间隔内的收益率，因此有

$$\frac{dS(t)}{S(t)}=\mu dt+\sigma dB(t)$$

因此 $S(t)$ 的随机微分方程为：

$$dS(t)=\mu S(t)dt+\sigma S(t)dB(t)$$

满足上述随机微分方程的股价 $S(t)$ 是一个几何布朗运动。人们喜欢使用几何布朗运动来描述股价的原因是：

1.  正态分布：经验事实证明，股票价格的连续复利收益率近似地服从正态分布；
2.  马尔科夫过程：由布朗运动的性质可知，服从上述模型的股票价格是一个马尔科夫过程，即当前价格就包含了对其未来做预测所需的全部信息，这与弱有效市场假说相符；
3.  布朗运动在时间上处处不可微以及二次变分不为零的性质符合股票收益率在时间上存在转折尖点的特征。

当然，为了使用 $S(t)$ 对股价进行分析，必须能够求解上述随机微分方程。这需要用到伊藤微积分中的相关内容。因此关于 $S(t)$ 的求解将会在本系列的后篇中具体介绍。

在结束本节之前，再来看一个关于带漂移项的布朗运动的有意思的例子。考虑一个正实数 $μ$ ，令 $X(t) = μt + B(t)$ 。由于 $B(t)$ 的期望为 0，因此 $X(t)$ 的期望为 $E[X(t)] = μt$ 。我们好奇的是，随着时间 $t$ 的推移， $X(t)$ 的取值到底是由 $μt$ 主宰还是由 $B(t)$ 主宰。事实上，可以证明， $X(t)$ 的取值是由 $μt$ 支配。对于任何给定的 $ε$ ，只要时间 $t$ 足够长，那么可以证明 $X(t)$ 总会在 $y = (μ – ε)t$ 和 $y = (μ + ε)t$ 之间！

怎么样？有没有从这个例子中受到什么启发？它说明，如果我们坚信股市长期来看有慢牛行情（ $μ > 0$ ），那么我们就应该欣然的接受它的任何（短期）波动而坚持持股（即忽略 $B(t)$ 的随机性造成的扰动）。因为长期来看股价的变化是由 $μt$ 决定的。我猜巴菲特一定是个数学家，他一定深谙此道，且通过其价值投资体系使得他的投资组合有着比美股指数更高的 $μ$，因此获得了长期稳定的超额收益。

## 6 伊藤引理

布朗运动为人们研究股票价格提供了基础。然而，对于金融衍生品，它们的价格是股票价格的函数。令 $f(B_t)$ 为布朗运动 $B_t$ 的连续平滑函数，在金融数学领域的一个重要的分析课题是研究在无穷小的时间区间内 $f$ 是如何变化的，即 $df$ 的性质。由下文可知，由于布朗运动是不可微的，古典微积分对于求解 $df$ 无能为力，而日本数学家伊藤清（Itō Kiyoshi）提出了与古典微积分不同的伊藤微积分打开了解决这个问题的大门，并为随机分析奠定了坚实的基础。

让我们首先来看看古典微积分是如何失效的。为求 $df$ （ $f$ 是布朗运动 $B_t$ 的连续平滑函数），应用古典微积分中的链式法则（chain rule）可得：

$$df=\left(\frac{dB_t}{dt}f'(B_t)\right)dt$$

由于布朗运动 $B_t$ 处处不可微，因此导数 $dB_t/dt$ 不存在，所以上式没有意义。第一次尝试失败。

那么我们能不能绕过 $dB_t/dt$ 呢，而仅仅使用 $dB_t$ 呢？前文已经指出 $dB_t$ 有明确的含义，它表示布朗运动在一个无穷小的时间间隔内的变化。因此我们有：

$$df=f'(B_t)dB_t$$

在这个表达式下， $f'(B_t)$ 是可求的（因为 $f$ 是一个连续平滑函数），而 $dB_t$ 也是可求的。看似我们绕过了 $B_t$ 处处不可微的问题。不幸的是，上面这个等式是不成立的。第二次尝试依然以失败收场。

来看看上面这个式子为什么是错的。不要忘了，它实际上来自[泰勒展开（Taylor expansion）](泰勒展开（Taylor%20expansion）)。考虑一个一般函数 $f(x)$ 的泰勒展开：

$$f(x+\Delta x)-f(x)=f'(x)(\Delta x)+\frac{f''(x)}{2}(\Delta x)^2+\frac{f'''(x)}{6}(\Delta x)^3+\cdots$$

事实上，对于一般的函数，由泰勒展开确实有 $df = f'(x)dx$ ，这是因为当 $Δx$ 趋近于 0 时，上式右侧中除了第一项 $f'(x) Δx$ 外，其他所有项相当于第一项都是高阶小量、可以被忽略，因此上式的无穷小量的形式就是 $df = f'(x)dx$ 。但是，当 $x = B_t$ 时，这个性质并不成立。将 $x$ 替换为 $B_t$ 代入上式：

$$\begin{array}{rll} \Delta f&=&f(B_t+\Delta B_t)-f(B_t)\\ &=&\displaystyle f'(B_t)(\Delta B_t)+\frac{f''(B_t)}{2}(\Delta B_t)^2+\frac{f'''(B_t)}{6}(\Delta B_t)^3+\cdots\\ \end{array}$$

显然，在上式右侧中，第一项 $f'(B_t)ΔB_t$ 是重要的。那么其他项相对它来说可以忽略吗？你也许已经猜到答案了：二次变分 $(dB)^2 = dt$ ！因为布朗运动的二次变分非 0，因此上式右侧的第二项相对于第一项不是更高阶的小量，而是同阶的，因此它不能被略去（从第三项之后仍然是相对前两项的高阶小量，可以被忽略）。在无穷小量形式下忽略掉右侧第三项开始之后的所有项，并利用 $(dB)^2 = dt$ ，我们得到伊藤引理（Itō’s lemma）的最基本形式：

$$df(B_t)=f'(B_t)dB_t+\frac{1}{2}f''(B_t)dt$$

它也是伊藤微积分中的基本关系式。

更一般的，如果一个平滑函数 $f$ 是时间 $t$ 和某标量 $x$ 的函数，由古典微积分可知：

$$df=\frac{\partial f}{\partial t}dt+\frac{\partial f}{\partial x}dx$$

如果 $x$ 为布朗运动 $B_t$ ，则由伊藤微积分有：

$$\begin{array}{rll} df&=&\displaystyle\frac{\partial f}{\partial t}dt+\frac{\partial f}{\partial x}dB_t+\frac{1}{2}\frac{\partial^2 f}{\partial x^2}(dB_t)^2\\ &=&\displaystyle\left(\frac{\partial f}{\partial t}+\frac{1}{2}\frac{\partial^2 f}{\partial x^2}\right)dt+\frac{\partial f}{\partial x}dB_t \end{array}$$

可见，布朗运动的二次变分造成求解 $df$ 时，必须在古典微积分的基础上考虑一个额外项。它就是 $f$ 对标量项（这里，标量是 $B_t$ 的取值）的二阶导数（如果 $f$ 仅仅是 $B_t$ 的函数）或者二阶偏导数（如果 $f$ 即是 $B_t$ 的函数又是 $t$ 的函数）。这个结论，现在看来“不怎么起眼”，但是它改变了一切，它使人们可以将微积分运用到随机过程中。

我们会在本系列后篇中从伊藤引理出发继续阐述如何求解几何布朗运动的随机微分方程以及如何推导出 BS 期权定价公式。

## 7 小结

首先恭喜你看到这里……随机分析绝不是一个令人愉悦的课题；这篇文章也比我想象的写起来更加耗时，原因是我想尽可能把复杂的概念简单的说清楚，并把数学模型和股票波动联系起来。

让我们来简单总结一下本文都说了点啥。

布朗运动是一个用来描述股价走势的有效模型。它的马尔科夫性符合弱有效市场假说。通过反射性，很容易计算出布朗运动在一段时间内能够到达的极值的概率分布，这对于投资中的风控至关重要。进一步的，几何布朗运动可以作为对股价建模的更精确的模型。从长期来看，几何布朗运动的走势由漂移项控制，这意味着对于慢牛的市场我们要做的是坚定价值投资、长期持股、忽视股价短期由随机游走带来的波动。

另一方面，布朗运动虽然连续，但是它处处不可微，这和股价的剧烈波动上蹿下跳给人的感受是一致的。在金融数学中，很重要的课题是分析随机过程的函数（比如衍生品的价格是股票价格的函数）在无穷小的时间区间内如何变化，但布朗运动的不可微性和二次变分使得古典微积分对它无能为力。日本数学家伊藤清提出了古典微积分的变种——伊藤微积分，它考虑了布朗运动的二次变分，从而提供了使用微积分的手段分析随机过程及其函数的框架，奠定了现代金融数学的基础。

## 2 伊藤引理的一般形式

在前篇中，我们介绍了带有漂移（drift）和扩散（diffusion）的布朗运动有如下形式的随机微分方程。在这里， $μ$ 和 $σ$ 被假定为常数。

$dX(t)=\mu dt+\sigma dB(t)$

更一般的，漂移和扩散的参数均可以是随机过程 $X(t)$ 以及时间 $t$ 的函数。假设我们令 $a(X(t),t)$ 和 $b(X(t),t)$ 表示漂移和扩散参数（则在上面这个例子中， $a(X(t),t) = μ$ 而 $b(X(t),t) = σ$ ）。我们称满足如下随机微分方程（stochastic differential equation，或 SDE）的随机过程为伊藤漂移扩散过程（Itō drift-diffusion process，下称伊藤过程）：

$dX(t)=a(X(t),t)dt+b(X(t),t)dB(t)$

令 $f(X(t), t)$ 为 $X(t)$ 的二阶连续可导函数（并对 $t$ 一阶可导），由伊藤引理可知（省略自变量以简化表达）：

$df=\frac{\partial f}{\partial t}dt+\frac{\partial f}{\partial X}dX+\frac{1}{2}\frac{\partial^2f}{\partial X^2}(dX)^2$

将 $dX = a(X(t),t)dt + b(X(t),t)dB$ 带入上式，并且略去所有比 $dt$ 更高阶的小量，最终可以得到伊藤引理的一般形式：

$df=\left(\frac{\partial f}{\partial t}+\frac{\partial f}{\partial X}a+\frac{1}{2}\frac{\partial^2 f}{\partial X^2}b^2\right)dt+\frac{\partial f}{\partial X}bdB$

由 $f$ 的 SDE 可知，作为 $X$ 和 $t$ 的函数， $f$ 本身也是一个伊藤过程。更重要的是，伊藤引理说明， $df$ 表达式右侧的布朗运动 $dB$ 恰恰正是 $dX$ 表达式中的那个布朗运动。换句话说，在 $f$ 和 $X$ 的随机性由同一个布朗运动决定，而非两个独立的布朗运动。这一点在下文中推导 BS 微分方程时至关重要。

下面我们就利用伊藤引理求解几何布朗运动。

## 3 几何布朗运动求解

对于股票价格 $S$ ，可以用满足如下 SDE 的几何布朗运动来描述。

$dS=\mu Sdt+\sigma SdB$

上式中 $\mu$ 是股票的期望年收益率， $\sigma$ 是股票年收益率的标准差。显然，这是一个伊藤过程（ $a = μS，b = σS$ ）。为了求解 $S$ ，令 $f = \ln S$ 并对 $df$ 使用伊藤引理（注：为了保持符号和前篇的一致性，我们用 $S$ 而非 $X$ 代表股票价格的随机过程）得到 $\ln S$ 的 SDE：

$d(\ln S)=df=\left(\mu-\frac{\sigma^2}{2}\right)dt+\sigma dB$

这个式子说明， $\ln S$ 是一个带漂移的布朗运动，它的漂移率为 $μ – 0.5σ^2$ ，波动率为 $\sigma$ 。由布朗运动的性质可知，在任何时间 $T$ ， $\ln S$ 的变化符合正态分布：

$\ln S(T)\sim\Phi\left[\ln S(0)+\left(\mu-\frac{\sigma^2}{2}\right)T,\sigma^2T\right]$

如果一个随机变量的对数满足正态分布，我们说这个随机变量本身满足对数正态分布（lognormal distribution）。因此，当我们用几何布朗运动来描述股价波动时，得到的股价满足对数正态分布。

通过对 $\ln S$ 的 SDE 两边积分，再对等式两边取指数，便可很容易的写出股价随时间变化的解析式：

$S(T)=S(0)\exp\left(\left(\mu-\frac{\sigma^2}{2}\right)T+\sigma B(T)\right)$

上式乍一看好像有悖于我们的直觉。我们已知股票的年收益率期望为 $μ$ 。但在上式中，抛开 $B(T)$ 带来的随机性不谈而仅看时间 $T$ 的系数，股价的增长速率是 $μ – 0.5σ^2$ 而不是 $μ$ 。这意味着什么呢？数值 $μ – 0.5σ^2$ 又是否是什么别的收益率呢？

正确答案是， $μ – 0.5σ^2$ 恰恰是股票每年的连续复利期望收益率。利用股价 $S$ 的对数正态特性可以说明这一点。假设 $x$ 代表股票每年的连续复利收益率。因此有 $S(T) = S(0)e^{xT}$ ，或 $x = (1/T)×(\ln S(T) - \ln S(0))$ 。由上面的分析可知， $\ln S(T) – \ln S(0)$ 符合均值为 $(μ – 0.5σ^2)T$ 、方差为 $(σ^2)T$ 的正态分布。因此每年的连续复利收益率 $x$ 也是正态分布并且满足：

$x\sim\Phi\left(\mu-\frac{\sigma^2}{2},\frac{\sigma^2}{T}\right)$

直观比较股票的每年期望收益率 $\mu$ 和每年连续复利期望收益率 $μ – 0.5σ^2$ ，后者考虑了波动 $\sigma$ ，它们的区别就是年收益率序列算数平均值和几何平均值的区别。

来看一个例子。假设某股票在过去五年的年收益率分别为 15%，20%，30%，-20% 和 25%。这个序列的算数平均值为 14%，因此该股票的每年的（样本）期望收益率 $μ = 14\%$ 。再来看看它每年连续复利期望收益率是多少。假设我们在五年前花 100 块买入它并持有 5 年，那么在 5 年后我们的回报是 100×1.15×1.20×1.30×0.80×1.25 = 179.4。因此每年（样本）连续复利期望收益率（即这个收益率序列的几何平均值）为 12.4%，显然它低于算数平均值。

## 4 Black-Scholes 微分方程

本节介绍 Black-Scholes 期权定价微分方程。细心如你一定已经发现了，“随机”两个字被拿掉了，而 BS 方程是一个微分方程，说明它不再具备任何随机因素，这是喜闻乐见的，因为没有多少人喜欢随机性。读完本节你就会明白这是为什么。

首先来看推导 BS 微分方程时用到的假设：

1. 期权的行权方式为欧式，即只有到期日才可以行权。
2. 股票的价格符合几何布朗运动，即股票的不确定性满足对数正态分布。
3. 可以做空证券，且证券可以被分割（如可以买卖半手股票）。
4. 市场无摩擦，即不存在交易费用和税收。
5. 在期权期限内，标的股票不支付股息。
6. 在期权期限内，标的股票年收益率的标准差 $\sigma$ 已知且保持不变。
7. 市场不存在无风险套利机会。
8. 标的资产交易是连续的（如股票市场始终开市）。
9. 短期无风险利率（由 $r$ 表示）为常数并已知。

显然，有些假设在真实交易中是不可能出现的，但是在确定期权的理论价值时，这些假设还是普遍被接受的。当然，自 BS 模型发明以来，衍生品定价也有了长足的发展。很多改进的模型相继被提出，用于修正 BS 模型中各种假设。下面以欧式看涨期权（European call option）为例介绍 BS 微分方程。

令 $C$ 代表欧式看涨期权的价格，显然它是标的股票价格 $S$ 和时间 $t$ 的函数，记为 $C(S, t)$ 。对 $C$ 运用伊藤引理可得：

$dC=\left(\frac{\partial C}{\partial S}\mu S+\frac{\partial C}{\partial t}+\frac{1}{2}\frac{\partial^2C}{\partial S^2}\sigma^2S^2\right)dt+\frac{\partial C}{\partial S}\sigma SdB$

让我们来看看在一个微小的时间区间 $Δt$ 内股价 $S$ 和期权价格 $C$ 如何变化。为此，将 $S$ 和 $C$ 的随机微分方程离散化：

$\begin{array}{rll} \Delta C&=&\displaystyle\left(\frac{\partial C}{\partial S}\mu S+\frac{\partial C}{\partial t}+\frac{1}{2}\frac{\partial^2C}{\partial S^2}\sigma^2S^2\right)\Delta t+\frac{\partial C}{\partial S}\sigma S\Delta B\\\\ \Delta S&=&\mu S\Delta t+\sigma S\Delta B \end{array}$

在本文第二节我们曾经强调过，一个伊藤过程 $X$ 的函数 $f$ 也是一个伊藤过程，且 $f$ 和 $X$ 这两个随机过程中的不确定性来自同一个布朗运动。根据这个性质可知，股价和期权价格的变化，即 $ΔC$ 和 $ΔS$ 中，的布朗运动也是同一个。认识到这一点是非常关键的，因为我们可以使用股票和期权来构建一个投资组合把这个布朗运动完全干掉。考虑下面这个投资组合：

$\begin{array}{rrl} -1&:&\mbox{option}\\ +\partial C/\partial S&:&\mbox{stock} \end{array}$

该组合做空 1 份期权，并做多 $\partial C/\partial S$ 份股票。将期权和股票的权重带入 $ΔC$ 和 $ΔS$ 可以很容易的验证，布朗运动 $ΔB$ 被完美的对冲掉了。这种构建投资组合以消除随机性的方法称为 Delta 对冲。

用 $P$ 表示该投资组合的价值，则它在时间 $Δt$ 内的变化为：

$\Delta P=\left(-\frac{\partial C}{\partial t}-\frac{1}{2}\frac{\partial^2 C}{\partial S^2}\sigma^2 S^2\right)\Delta t$

不出意外， $ΔB$ 不存在于 $ΔP$ 的表达式中，它仅有一个时间项。换句话说，通过卖出 1 份期权并同时买入 $∂C/∂S$ 份股票，我们在 $Δt$ 内完美的消除了任何风险，构建了一个无风险的投资组合。在不存在无风险套利的市场中，该投资组合在 $Δt$ 内的收益率必须等于无风险收益率 $r$ ，即 $ΔP = rPΔt$ 。将 $ΔP$ 和 $P = -C + (∂C/∂S)S$ 带入该式并进过简单的代数运算就推导出：

$\frac{\partial C}{\partial t}+rS\frac{\partial C}{\partial S}+\frac{1}{2}\sigma^2 S^2\frac{\partial^2C}{\partial S^2}=rC$

这便是大名鼎鼎的 Black-Scholes 微分方程。由于我们通过 Delta 对冲消除了随机性，该方程中没有任何随机变量，所以它是一个一般的（偏）微分方程，而非随机微分方程。求解这个微分方程需要给定的边界条件。对于欧式看涨期权，它的边界条件为当时间 $t = T$（行权时刻）时，期权的价格 $C$ 必须满足 $C = \max(S(T) - K, 0)$，这里 $K$ 是行权价格。

最后引用衍生品研究领域的著名学者约翰 • 赫尔（John C. Hull）在其著作 Options, Futures, and Other Derivatives 中的一段话来总结 BS 微分方程的推导过程：

我们之所以可以建立无风险交易组合是由于股票价格与期权价格均受同一种不定性的影响：股票价格的变动。在任意一段短时期内，衍生产品的价格与股票价格有完美的相关性；在建立了一个适当的股票与期权的组合后，由股票所带来的盈亏总是可以抵消由期权所带来的盈亏。这样一来，交易组合在一个短时间内的价值变化也就成为已知而没有不确定性。

## 5 风险中性定价理论

其实，使用给定的边界条件求解 BS 微分方程就可以得到欧式看涨期权的价格 $C$ 。然而，在衍生品的定价理论中还有一个非常重要的方法怎么强调都不为过，这就是风险中性定价理论（Risk-neutral valuation）。使用风险中性定价可以绕过求解 BS 微分方程，更加方便的求出 $C$ 。

仅仅看到这里也许你会误解：既然不用求解 BS 微分方程，那么费那么大力气推导它干什么？

然而，风险中性定价理论恰恰来自 BS 微分方程中的一个关键性质：

BS 微分方程不涉及任何受投资者风险偏好影响的变量，在方程中出现的变量包括股票的当前价格、时间、股票价格波动率和无风险利率，而它们均与风险选择无关。

从 BS 微分方程可知，标的股票的期望收益率 $\mu$ 没有出现在方程中。显然， $\mu$ 与投资者的风险偏好有关：投资者对风险的厌恶程度越高，对任何股票，相应的 $\mu$ 也会越高。可喜的是在采用 Delta 对冲构投资组合并推导 BS 微分方程时， $\mu$ 也正好消失了！我们通过 Delta 对冲想要干掉布朗运动，结果发现不仅布朗运动被干掉了，连 $\mu$ 也一起被拿下了，这真是一个 happy accident！

既然风险偏好在方程中不出现，那么意味着它的任何取值都不会影响方程的解。因此，在计算 $C$ 时，我们可以使用任意的风险偏好，那么显然我们想要一个最简单的，即假设所有的投资者都是风险中性的。

对于任何衍生品定价来说，我们无外乎需要知道以下两点：

1. 在到期（行权日）时它的期望价格。由于衍生品的价格是标的价格的函数，这显然和标的投资品的收益率参数 $\mu$ 有关。
2. 我们需要根据衍生品在行权日的价格推算出在当前时刻该衍生品的价格，这意味着必须知道适合于该衍生品的折现率。

不幸的是，在现实世界中，这两个参数都很难被准确的估计。因此能够假设风险中性对于衍生品定价至关重要。正如约翰 • 赫尔所论述的那样：

在每一个投资者都是风险中性的世界里，所有投资的回报率期望均为无风险利率 $r$ ，原因是对风险中性的投资者而言，不需要额外的回报而使他们承受风险。另外，在一个风险中性世界里，任何现金流的现值都可以通过对其期望值以无风险利率贴现来得到。因此，在假设世界是风险中性时能够大大地简化对衍生产品的分析。

利用风险中性定价原理对衍生品定价的过程如下：

1. 假定标的资产的收益率期望为无风险利率（即假定 $μ = r$ ）；
2. 计算衍生产品到期时收益的期望；
3. 用无风险利率 $r$ 对衍生品收益期望进行贴现。

风险中性定价是获得期权定价公式的一个人为工具，但它所得到的解不仅在这个虚拟的风险中性世界中成立，而且在所有世界里（自然也就包括真是世界）也都是成立的。当我们从风险中性世界换到风险厌恶世界时，两件事会发生：股票价格变动的增长率期望以及对衍生产品收益所必需使用的贴现率都将会变化，而这两种变化刚好相互抵消。

下一节将会介绍如何使用风险中性定价理论求解欧式看涨期权的价格 $C$ 。

## 6 Black-Scholes 期权定价公式

欧式看涨期权在行权日 $T$ 的期望价值为 $\mbox{E}[\max(S(T) – K, 0)]$，其中 $S(T)$ 为股票在 $T$ 时刻的价格， $K$ 为行权价。股价 $S$ 满足对数正态分布，在风险中性定价理论下， $S$ 的期望收益率为无风险收益率 $r$ ，且期权的折现率也等于无风险收益率 $r$ 。因此，期权在当前时刻的价格 $C$ 为：

$C=e^{-rT}\mbox{E}[\max(S(T) – K, 0)]$

根据对数正态分布的性质可以方便的计算出 $\mbox{E}[\max(S(T) – K, 0)]$，从而得到著名的 BS 期权定价公式（同时给出看涨期权价格 $C$ 和看跌期权价格 $P$ ）：

$\begin{array}{rrll} &C&=&S(0)N(d_1)-Ke^{-rT}N(d_2)\\\\ &P&=&Ke^{-rT}N(-d_2)-S(0)N(-d_1)\\\\ \mbox{where}&d_1&=&\displaystyle\frac{\ln(S(0)/K)+(r+\sigma^2/2)T}{\sigma\sqrt T}\\\\ &d_2&=&\displaystyle\frac{\ln(S(0)/K)+(r-\sigma^2/2)T}{\sigma\sqrt T}=d_1-\sigma\sqrt T\\\\ &N&:&\mbox{cumulative distribution function of standard Normal} \end{array}$

根据公式并利用计算机，只要输入五个变量——当前股价 $S(0)$ 、行权价格 $K$ ，行权日距现在的时间（按年计算） $T$ ，无风险收益率 $r$ ，以及标的股票的年收益率的标准差 $\sigma$ ——就可以计算出欧式看涨（看跌）期权的理论价格，这无疑非常方便。然而我们需要了解定价公式背后的含义。

对于任何一个期权，在定价时有两个不确定性需要考虑：

1. 这个期权到行权日到底是不是实值期权（in-the-money），就是到底有没有行权的价值（比如说我买了一个看涨期权，但是行权日股价 $S$ 低于 $K$，那么这个期权就没有价值）。
2. 如果行权了，那么我们的（期望）收益到底能有多少（比如行权价是 100，在行权日股价是 110，那么每股我们能赚 10 块；而如果股价是 120，则每股我们能赚 20 块）。

这两个不确定性恰恰就对应着由 BS 定价公式中的 $N(d_1)$ 和 $N(d_2)$ 。

以看涨期权为例来解释这一点。在 BS 公式中， $N$ 代表了标准正态分布的累积密度函数，因此 $N(d_1)$ 和 $N(d_2)$ 就代表两个概率。其中， $N(d_2)$ 正是在风险中性世界中期权被行权的概率，即 $\mbox{Prob}(S(T) > K)$ 。因此 $C$ 公式中的第二项 $Ke^{-rT}N(d_2)$ 就是在当前时点、考虑了行权概率后的行权费的期望（即为了在 $T$ 购买股票所需的期望成本）。

至于 $N(d_1)$ ，对于它的理解远没有 $N(d_2)$ 直观。先抛开 $N(d_1)$ 不说，而来看看 $C$ 公式中的第一项。由于第二项代表着期望成本，那么第一项必然代表着行权得到股票的期望收益。由于只有 $S(T)$ 大于 $K$ 才会行权，因此在行权的条件下，股票在行权时的期望价值是一个条件期望，即 $\mbox{E}[S(T) | S(T) > K]$ 。用这个条件期望乘以行权的概率 $N(d_2)$ 再把它折现到今天（乘以 $e^{-rT}$ ）就应该是 $C$ 公式中的第一项。因此有：

$e^{-rT}\mbox{E}[S(T)|S(T)>K]N(d_2)=S(0)N(d_1)$

将 $S(0)$ 替换为 $e^{-rT}E[S(T)]$ 并带入上式可知：

$N(d_1)=\frac{\mbox{E}[S(T)|S(T)>K]}{\mbox{E}[S(T)]}N(d_2)$

由于 $\mbox{E}[S(T) | S(T) > K] > \mbox{E}[S(T)]$ ，因此 $N(d_1) > N(d_2)$ （这从 $d_1$ 大于 $d_2$ 且 N 是单调增函数也可以验证）。根据这个关系，我们可以把 $N(d_1)$ 理解为风险中性世界中、按照股票价格加权的行权概率。这是因为和固定的行权成本 $K$ 不同（ $K$ 是独立于股价 $S$ 的），收益和股价之间不是独立的。

$N(d_1)$ 在数学上还有另外的解释，它是“以股票波动率 $\sigma$ 为市场风险定价，并在以股票为计价单位时，期权被行权的概率”。如果你觉着这句话是天书也没有任何问题，因为要解释它需要涉及到测度变换、等价鞅、以及计价单位变换等高深的数学知识。这些显然超出本文的范畴。

如果我们使用 $C$ 的公式对 $S$ 求偏导数，那么不难发现 $N(d_1)$ 恰恰等于 $∂C/∂S$ 。因此在现实中，投资者把 $N(d_1)$ 理解为看欧式涨期权价格 $C$ 对标的股票价格 $S$ 的变化的敏感程度。

看到这里，也许你会发问：BS 定价公式仅仅给出了一个基于各种严格假设的理论价格，它在现实中到底有没有用？真的会有人因为理论价格和实际交易价格不同来构建策略并且赚钱吗？

BS 定价公式的核心价值在于它构建了一个数学模型，以此我们可以求出期权的各种风险敞口，这对于将期权（或任何衍生品）作为配置资产的投资者至关重要。由 BS 公式出发可以方便的求出期权价格对标的资产、时间、利率、波动率的偏导数，从而确定期权在这些因素上的风险敞口。在投资中，常用的风险敞口有五类（通常用希腊字母来表示），它们是：

![](../../附件/Pasted%20image%2020220214105520.png)

我们会在后续的文章中进一步介绍这些风险敞口。

除此之外，BS 公式的另一个核心作用是计算标的资产的隐含波动率。在 BS 公式中，除去 $\sigma$ 之外的输入参数的取值都比较确定，唯有 $\sigma$ 可能会随着使用者的不同而不同。根据期权的实际交易价格，可以利用 BS 公式反推出标的波动率 $\sigma$ ，称为隐含波动率，这往往代表着市场对于标的资产风险的普遍观点。隐含波动率最有名的应用大概是芝加哥交易所针对标普 500 指数，利用未来 30 天的看涨和看跌期权计算的 VIX 指标，又称为恐慌指数。它被投资者广泛参考。

## 7 小结

和本系列前篇一样，再次恭喜你看到这里……下面，让我们来简单总结一下本文都说了点啥。

本文首先定义了伊藤过程，并给出了伊藤引理的一般形式，通过它可以方便的写出伊藤过程的函数的随机微分方程。伊藤引理说明伊藤过程的函数也是一个伊藤过程，且它的随机性和原始的伊藤过程来自同一个布朗运动，这对于推演 BS 微分方程至关重要。

利用伊藤引理，可以很容易的求解几何布朗运动，从而得到股价的描述模型。在几何布朗运动的假设下，股价满足对数正态分布，这也是 BS 定价模型的假设之一。在股价模型中，年收益率期望和连续复利收益率期望是两个不同的概念，它们的区别相当于收益率序列的算数平均值和几何平均值的区别。

最后利用 Delta 对冲，利用标的股票和期权构建投资组合从而完美的消除了布朗运动的随机性，从而得到了 BS 微分方程，这是衍生品定价的基础。此外，在 Delta 对冲下，和投资者风险偏好相关的参数 $\mu$ 也从 BS 方程中消失了。由此引出了衍生品定价中的一个非常重要的方法：风险中性定价理论。根据该理论求出了欧式期权的价格，并以看涨期权为例解释了价格表达式中每一项的业务含义。文章最后介绍了 BS 公式在实际投资中的核心作用：它可以量化期权的各种风险敞口，这对于配置期权的投资者至关重要。
